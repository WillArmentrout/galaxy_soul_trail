stardict = {'red': [(0.0, 0.6470588235294118, 0.6470588235294118),
  (0.10971433458868048, 0.8431372549019608, 0.8431372549019608),
  (0.21942866917736095, 0.9568627450980393, 0.9568627450980393),
  (0.3291430037660414, 0.9921568627450981, 0.9921568627450981),
  (0.4388573383547219, 0.996078431372549, 0.996078431372549),
  (0.5485716729434024, 1.0, 1.0),
  (0.7732172226391819, 1.0, 1.0),
  (0.7903998275867192, 0.8784313725490196, 0.8784313725490196),
  (0.8075824325342565, 0.6705882352941176, 0.6705882352941176),
  (0.824765037481794, 0.4549019607843137, 0.4549019607843137),
  (0.8419476424293313, 0.27058823529411763, 0.27058823529411763),
  (1.0, 0.19215686274509805, 0.19215686274509805)],
 'green': [(0.0, 0.0, 0.0),
  (0.10971433458868048, 0.18823529411764706, 0.18823529411764706),
  (0.21942866917736095, 0.42745098039215684, 0.42745098039215684),
  (0.3291430037660414, 0.6823529411764706, 0.6823529411764706),
  (0.4388573383547219, 0.8784313725490196, 0.8784313725490196),
  (0.5485716729434024, 1.0, 1.0),
  (0.7732172226391819, 1.0, 1.0),
  (0.7903998275867192, 0.9529411764705882, 0.9529411764705882),
  (0.8075824325342565, 0.8509803921568627, 0.8509803921568627),
  (0.824765037481794, 0.6784313725490196, 0.6784313725490196),
  (0.8419476424293313, 0.4588235294117647, 0.4588235294117647),
  (1.0, 0.21176470588235294, 0.21176470588235294)],
 'blue': [(0.0, 0.14901960784313725, 0.14901960784313725),
  (0.09142861215723373, 0.15294117647058825, 0.15294117647058825),
  (0.18285722431446746, 0.2627450980392157, 0.2627450980392157),
  (0.2742858364717012, 0.3803921568627451, 0.3803921568627451),
  (0.36571444862893493, 0.5647058823529412, 0.5647058823529412),
  (0.4571430607861687, 0.7490196078431373, 0.7490196078431373),
  (0.5485716729434024, 0.9725490196078431, 0.9725490196078431),
  (0.7732172226391819, 0.9725490196078431, 0.9725490196078431),
  (0.7903998275867192, 0.9137254901960784, 0.9137254901960784),
  (0.8075824325342565, 0.8196078431372549, 0.8196078431372549),
  (0.824765037481794, 0.7058823529411765, 0.7058823529411765),
  (1.0, 0.5843137254901961, 0.5843137254901961)],
 'alpha': [(0.0, 1, 1),
  (0.1, 1, 1),
  (0.2, 1, 1),
  (0.30000000000000004, 1, 1),
  (0.4, 1, 1),
  (0.5, 1, 1),
  (0.6000000000000001, 1, 1),
  (0.7000000000000001, 1, 1),
  (0.8, 1, 1),
  (0.9, 1, 1),
  (1.0, 1, 1)]}
  
from matplotlib.colors import LinearSegmentedColormap
import astropy.units as un
from astropy.coordinates import SkyCoord, Distance

starcmap = LinearSegmentedColormap('starcmap', segmentdata=stardict, N=256)

def get_pos_col(gaiadf):
    gaiadf = gaiadf[gaiadf['parallax'] >0]
    gaiadistance = Distance(parallax=gaiadf['parallax'].filled().data*un.mas, allow_negative=True)
    c = SkyCoord(l=gaiadf['l'], b =gaiadf['b'], distance=gaiadistance, frame='galactic', unit=[un.deg, un.deg, un.parsec])
    cg = c.galactocentric
    absmag = gaiadf['phot_g_mean_mag'] - 5*np.log10(gaiadistance.value) + 5
    normabsmag = (absmag - np.min(absmag))/(np.max(absmag) - np.min(absmag))
    rgba = starcmap(normabsmag)
    return cg.x.value, cg.y.value, cg.z.value, rgba